<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='UTF-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Kristofer Hacker News</title>
  <link rel="stylesheet" href="./koley.css?v=1">
</head>

<body>

  <h1>Very Latest Hacker News</h1>
  <section id="section">
    <div id='posts'></div>
  </section>
</body>

<script>
  const API_URL = `http://localhost:8080`

  function fetchData() {
    fetch(`${API_URL}/news`)
    .then((res) => {
      //console.log("res is ", Object.prototype.toString.call(res));
      return res.json();
    })
    .then((data) => {
      show(data)
    })
    .catch((error) => {
      console.log(`Error Fetching data : ${error}`)
      document.getElementById('posts').innerHTML = 'Error Loading Data'
    })
}

function dateOf(date) {
  const milliseconds = date * 1000 // 1575909015000
  const dateObject = new Date(milliseconds)
  const humanDateFormat = dateObject.toLocaleString() //2019-12-9 10:30:15
  return humanDateFormat
}

function show(data) {
  // the data parameter will be a JS array of JS objects
    const ul = document.getElementById('posts');
    const list = document.createDocumentFragment();

    data.map(function (post) {
      console.log("Story:", post);
        let li = document.createElement('li');
        let title = document.createElement('h3');
        let body = document.createElement('p');
        let by = document.createElement('p');
        title.innerHTML = `<a href="${post.url}">${post.title}</a>`;
        body.innerHTML = `${post.url}`;
        let postedTime = dateOf(post.time)
        by.innerHTML = `${postedTime} - ${post.by}`;

        li.appendChild(title);
        li.appendChild(body);
        li.appendChild(by);
        list.appendChild(li);
    });

    ul.appendChild(list);
}
fetchData()

</script>

</html>